<html>
    <head>
        <link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="css/main.css" />
    </head>
    <body>
        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Found sunshine in a bag. Next up, level </h4>
              </div>
              <div class="modal-footer">
                <button id="reset" class="btn btn-primary" data-dismiss="modal">Next Level</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            var initProb = 0.9;
            var didWin = false;
            var level = 1;
            
            resetBags(initProb);
            $("#reset").click(function(){
                resetBags(initProb/2);
                didWin = false;
            });
            $('#myModal').on('hidden.bs.modal', function (e) {
                if (didWin){
                    resetBags(initProb/2);
                    didWin = false;
                }
            });
            
            function resetBags(nextProb){
                console.log("level: " + level);
                $(".bag").remove();
                for (var i = 0; i < 4; i++){
                    $("body").append('<div class="bag" data-layer="1" style="background-image: url(images/bag.png);"></div>');
                }
                initProb = nextProb;
                initializeBags($(".bag"));
            }
            
            // Split into 4 bags of equal size
            function initializeBags(that){
                that.click(function(){
                    var layer = parseInt($(this).data("layer"));
                    var prob = initProb/layer * $(".bag[data-layer=" + layer + "]").length;
                    console.log("prob: " + prob);
                    var didFind = Math.random() < prob;
                    
                    if (!didFind){
                        for (var i = 0; i < 4; i++){
                            $(this).append('<div class="bag" data-layer="' + (layer+1) + '" style="background-image: url(images/bag.png);"></div>');
                        }
                        initializeBags($(this).children(".bag"));
                        $(this).unbind("click").css("background-image", "none");
                    }
                    else {
                        $(this).css("background-image", "url(images/sunshine.png)");
                        $(".bag").unbind("click");
                        didWin = true;
                        level++;
                        $("#myModalLabel").text("Found sunshine in a bag. Next up, level " + level + ".");
                        $("#myModal").modal();
                    }
                });
            }
            
            function randColor(){
                return '#'+Math.floor(Math.random()*16777215).toString(16);
            }
        </script>
    </body>
</html>